<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BOOOMERANGS –ö–æ–º–∞–Ω–¥–Ω—ã–π –ß–∞—Ç</title>
  <style>
    :root {
      --bg: #0f0f1a;
      --chat-bg: #1a1a2e;
      --accent: #6c63ff;
      --text: #ffffff;
      --text-secondary: #b8b8b8;
      --border: #2d2d3a;
      --user-msg: #2563eb;
      --team-msg: #059669;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
      height: 100vh;
      overflow: hidden;
    }

    .container {
      display: grid;
      grid-template-columns: 300px 1fr;
      height: 100vh;
    }

    /* –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥—ã */
    .team-panel {
      background: var(--chat-bg);
      border-right: 1px solid var(--border);
      padding: 20px;
      overflow-y: auto;
    }

    .team-header {
      margin-bottom: 20px;
      text-align: center;
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      margin-bottom: 10px;
    }

    .team-title {
      font-size: 1.2rem;
      color: var(--accent);
      margin-bottom: 5px;
    }

    .team-subtitle {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    .user-list {
      list-style: none;
    }

    .user-item {
      padding: 12px;
      margin-bottom: 8px;
      background: rgba(108, 99, 255, 0.1);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid transparent;
    }

    .user-item:hover {
      background: rgba(108, 99, 255, 0.2);
      border-color: var(--accent);
    }

    .user-item.active {
      background: var(--accent);
      color: white;
    }

    .user-name {
      font-weight: 500;
      margin-bottom: 2px;
    }

    .user-status {
      font-size: 0.75rem;
      color: var(--text-secondary);
    }

    .user-item.active .user-status {
      color: rgba(255, 255, 255, 0.8);
    }

    /* –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - —á–∞—Ç */
    .chat-panel {
      display: flex;
      flex-direction: column;
      background: var(--bg);
    }

    .chat-header {
      padding: 20px;
      background: var(--chat-bg);
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-title {
      font-size: 1.1rem;
      color: var(--text);
    }

    .ai-button {
      padding: 8px 16px;
      background: var(--accent);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 0.9rem;
      transition: all 0.2s ease;
    }

    .ai-button:hover {
      background: #5a52d5;
    }

    .chat-messages {
      flex: 1;
      padding: 20px;
      overflow-y: auto;
      background: var(--bg);
    }

    .message {
      margin-bottom: 16px;
      max-width: 80%;
    }

    .message.own {
      margin-left: auto;
    }

    .message-header {
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 4px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .message.own .message-header {
      justify-content: flex-end;
    }

    .message-content {
      padding: 12px 16px;
      border-radius: 12px;
      background: var(--team-msg);
      color: white;
      word-wrap: break-word;
    }

    .message.own .message-content {
      background: var(--user-msg);
    }

    .chat-input-container {
      padding: 20px;
      background: var(--chat-bg);
      border-top: 1px solid var(--border);
      display: flex;
      gap: 12px;
      align-items: flex-end;
    }

    .chat-input {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 12px 16px;
      color: var(--text);
      font-size: 0.9rem;
      resize: none;
      max-height: 120px;
      min-height: 44px;
    }

    .chat-input:focus {
      outline: none;
      border-color: var(--accent);
    }

    .send-button {
      background: var(--accent);
      border: none;
      border-radius: 12px;
      padding: 12px 16px;
      color: white;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .send-button:hover {
      background: #5a52d5;
    }

    .empty-state {
      text-align: center;
      color: var(--text-secondary);
      padding: 40px 20px;
    }

    .empty-state h3 {
      margin-bottom: 8px;
      color: var(--text);
    }

    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω */
    @media (max-width: 768px) {
      .container {
        grid-template-columns: 1fr;
      }
      
      .team-panel {
        position: fixed;
        left: -300px;
        top: 0;
        bottom: 0;
        width: 300px;
        z-index: 1000;
        transition: left 0.3s ease;
      }
      
      .team-panel.show {
        left: 0;
      }
      
      .chat-header {
        position: relative;
      }
      
      .menu-button {
        background: none;
        border: none;
        color: var(--text);
        font-size: 1.2rem;
        cursor: pointer;
        padding: 8px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- –õ–µ–≤–∞—è –ø–∞–Ω–µ–ª—å - –∫–æ–º–∞–Ω–¥–∞ -->
    <div class="team-panel" id="team-panel">
      <div class="team-header">
        <img src="booomerangs-logo.jpg" alt="BOOOMERANGS" class="logo">
        <div class="team-title">BOOOMERANGS</div>
        <div class="team-subtitle">–ö–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç</div>
      </div>
      
      <ul class="user-list" id="user-list">
        <!-- –°–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∫–æ–º–∞–Ω–¥—ã –±—É–¥–µ—Ç –∑–∞–≥—Ä—É–∂–µ–Ω –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
      </ul>
    </div>

    <!-- –ü—Ä–∞–≤–∞—è –ø–∞–Ω–µ–ª—å - —á–∞—Ç -->
    <div class="chat-panel">
      <div class="chat-header">
        <button class="menu-button" id="menu-button" style="display: none;">‚ò∞</button>
        <div class="chat-title" id="chat-title">–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –¥–ª—è —á–∞—Ç–∞</div>
        <button class="ai-button" onclick="window.location.href='/booomerangs-smart-chat.html'">
          ü§ñ AI –ß–∞—Ç
        </button>
      </div>
      
      <div class="chat-messages" id="chat-messages">
        <div class="empty-state">
          <h3>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–º–∞–Ω–¥–Ω—ã–π —á–∞—Ç!</h3>
          <p>–í—ã–±–µ—Ä–∏—Ç–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∏–∑ —Å–ø–∏—Å–∫–∞ —Å–ª–µ–≤–∞, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ.</p>
          <p>–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.</p>
        </div>
      </div>
      
      <div class="chat-input-container" id="input-container" style="display: none;">
        <textarea 
          class="chat-input" 
          id="chat-input" 
          placeholder="–ù–∞–ø–∏—à–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
          rows="1"
        ></textarea>
        <button class="send-button" id="send-button">
          –û—Ç–ø—Ä–∞–≤–∏—Ç—å
        </button>
      </div>
    </div>
  </div>

  <script>
    // –î–∞–Ω–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å—Å—è —Å —Å–µ—Ä–≤–µ—Ä–∞)
    const teamMembers = [
      { id: 1, name: '–ê–ª–µ–∫—Å–µ–π', status: '–æ–Ω–ª–∞–π–Ω', role: '–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫' },
      { id: 2, name: '–ú–∞—Ä–∏—è', status: '–æ–Ω–ª–∞–π–Ω', role: '–î–∏–∑–∞–π–Ω–µ—Ä' },
      { id: 3, name: '–î–º–∏—Ç—Ä–∏–π', status: '–æ—Ç–æ—à–µ–ª', role: '–ú–µ–Ω–µ–¥–∂–µ—Ä' },
      { id: 4, name: '–ê–Ω–Ω–∞', status: '–æ–Ω–ª–∞–π–Ω', role: '–¢–µ—Å—Ç–∏—Ä–æ–≤—â–∏–∫' },
      { id: 5, name: '–°–µ—Ä–≥–µ–π', status: '–æ—Ñ–ª–∞–π–Ω', role: '–ê–Ω–∞–ª–∏—Ç–∏–∫' },
      { id: 6, name: '–ï–ª–µ–Ω–∞', status: '–æ–Ω–ª–∞–π–Ω', role: '–ö–æ–Ω—Ç–µ–Ω—Ç' },
      { id: 7, name: '–ò–≥–æ—Ä—å', status: '–æ–Ω–ª–∞–π–Ω', role: 'DevOps' },
      { id: 8, name: '–û–ª—å–≥–∞', status: '–æ—Ç–æ—à–ª–∞', role: 'UX/UI' },
      { id: 9, name: '–ú–∞–∫—Å–∏–º', status: '–æ–Ω–ª–∞–π–Ω', role: 'Backend' },
      { id: 10, name: '–°–≤–µ—Ç–ª–∞–Ω–∞', status: '–æ—Ñ–ª–∞–π–Ω', role: 'Frontend' }
    ];

    let currentUserId = 1; // ID —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    let selectedPartnerId = null;
    let currentMessages = [];

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    document.addEventListener('DOMContentLoaded', function() {
      loadTeamMembers();
      setupEventListeners();
    });

    // –ó–∞–≥—Ä—É–∑–∫–∞ —Å–ø–∏—Å–∫–∞ –∫–æ–º–∞–Ω–¥—ã
    function loadTeamMembers() {
      const userList = document.getElementById('user-list');
      userList.innerHTML = '';

      teamMembers.forEach(member => {
        if (member.id === currentUserId) return; // –ù–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–µ–±—è

        const li = document.createElement('li');
        li.className = 'user-item';
        li.dataset.userId = member.id;
        
        li.innerHTML = `
          <div class="user-name">${member.name}</div>
          <div class="user-status">${member.role} ‚Ä¢ ${member.status}</div>
        `;
        
        li.addEventListener('click', () => selectUser(member));
        userList.appendChild(li);
      });
    }

    // –í—ã–±–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —á–∞—Ç–∞
    function selectUser(user) {
      selectedPartnerId = user.id;
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç
      document.querySelectorAll('.user-item').forEach(item => item.classList.remove('active'));
      document.querySelector(`[data-user-id="${user.id}"]`).classList.add('active');
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ —á–∞—Ç–∞
      document.getElementById('chat-title').textContent = `–ß–∞—Ç —Å ${user.name}`;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
      document.getElementById('input-container').style.display = 'flex';
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏
      loadConversation(currentUserId, selectedPartnerId);
      
      // –°–∫—Ä—ã–≤–∞–µ–º –ø–∞–Ω–µ–ª—å –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö
      if (window.innerWidth <= 768) {
        document.getElementById('team-panel').classList.remove('show');
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–ø–∏—Å–∫–∏
    async function loadConversation(userId1, userId2) {
      try {
        const response = await fetch(`/api/messages/${userId1}/${userId2}`);
        const data = await response.json();
        
        if (data.success) {
          currentMessages = data.messages;
          displayMessages();
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–µ–ø–∏—Å–∫–∏:', error);
      }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π
    function displayMessages() {
      const chatMessages = document.getElementById('chat-messages');
      chatMessages.innerHTML = '';

      if (currentMessages.length === 0) {
        chatMessages.innerHTML = `
          <div class="empty-state">
            <h3>–ù–∞—á–Ω–∏—Ç–µ –Ω–æ–≤—ã–π –¥–∏–∞–ª–æ–≥!</h3>
            <p>–û—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –æ–±—â–µ–Ω–∏–µ.</p>
          </div>
        `;
        return;
      }

      currentMessages.forEach(message => {
        const messageDiv = document.createElement('div');
        messageDiv.className = `message ${message.senderId === currentUserId ? 'own' : ''}`;
        
        const senderName = teamMembers.find(m => m.id === message.senderId)?.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        const time = new Date(message.timestamp).toLocaleTimeString('ru-RU', { 
          hour: '2-digit', 
          minute: '2-digit' 
        });
        
        messageDiv.innerHTML = `
          <div class="message-header">
            <span>${senderName}</span>
            <span>${time}</span>
          </div>
          <div class="message-content">${message.text}</div>
        `;
        
        chatMessages.appendChild(messageDiv);
      });

      // –°–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
    async function sendMessage() {
      const input = document.getElementById('chat-input');
      const text = input.value.trim();
      
      if (!text || !selectedPartnerId) return;

      try {
        const response = await fetch('/api/messages', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            senderId: currentUserId,
            receiverId: selectedPartnerId,
            text: text
          })
        });

        const data = await response.json();
        
        if (data.success) {
          // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π –º–∞—Å—Å–∏–≤
          currentMessages.push(data.message);
          displayMessages();
          
          // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
          input.value = '';
          input.style.height = 'auto';
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
      }
    }

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
    function setupEventListeners() {
      const chatInput = document.getElementById('chat-input');
      const sendButton = document.getElementById('send-button');
      const menuButton = document.getElementById('menu-button');

      // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
      sendButton.addEventListener('click', sendMessage);
      
      chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
          e.preventDefault();
          sendMessage();
        }
      });

      // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–¥—Å—Ç—Ä–æ–π–∫–∞ –≤—ã—Å–æ—Ç—ã –ø–æ–ª—è –≤–≤–æ–¥–∞
      chatInput.addEventListener('input', function() {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
      });

      // –ú–æ–±–∏–ª—å–Ω–æ–µ –º–µ–Ω—é
      if (menuButton) {
        menuButton.addEventListener('click', () => {
          document.getElementById('team-panel').classList.toggle('show');
        });
      }

      // –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å
      window.addEventListener('resize', () => {
        if (window.innerWidth <= 768) {
          document.getElementById('menu-button').style.display = 'block';
        } else {
          document.getElementById('menu-button').style.display = 'none';
          document.getElementById('team-panel').classList.remove('show');
        }
      });

      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–∞–∑–º–µ—Ä —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
      if (window.innerWidth <= 768) {
        document.getElementById('menu-button').style.display = 'block';
      }
    }
  </script>
</body>
</html>