<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Генератор</title>
    <style>
        body { font-family: system-ui, sans-serif; max-width: 800px; margin: 0 auto; padding: 1rem; }
        h1 { background: linear-gradient(45deg, #4a56e2, #6c63ff); -webkit-background-clip: text; background-clip: text; color: transparent; }
        input, button, textarea { padding: 0.5rem; margin: 0.5rem 0; width: 100%; border-radius: 4px; border: 1px solid #ccc; }
        button { background: linear-gradient(45deg, #4a56e2, #6c63ff); color: white; border: none; cursor: pointer; }
        .result { margin-top: 1rem; border: 1px solid #ccc; padding: 1rem; border-radius: 4px; }
        svg { max-width: 100%; background-color: white; }
        .loader { border: 5px solid #f3f3f3; border-top: 5px solid #4a56e2; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 1rem auto; display: none; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>
    <h1>SVG Генератор Изображений</h1>
    <p>Введите описание для генерации изображения и получения его в формате SVG</p>
    
    <form id="generator-form">
        <textarea id="prompt" placeholder="Например: космический корабль" rows="3" required></textarea>
        <button type="submit">Сгенерировать SVG</button>
    </form>
    
    <div class="loader" id="loader"></div>
    
    <div class="result" id="result" style="display:none">
        <h3>Результат:</h3>
        <div id="svg-output"></div>
        <textarea id="svg-code" rows="5" readonly style="font-size: 12px; font-family: monospace;"></textarea>
        <a id="download" download="image.svg" href="#" style="display: inline-block; margin-top: 1rem; text-decoration: none; background: #28a745; color: white; padding: 0.5rem; border-radius: 4px;">Скачать SVG</a>
    </div>
    
    <div id="chat-result" style="margin-top: 1rem; display: none;">
        <h3>Описание от Qwen:</h3>
        <div id="chat-response" style="padding: 1rem; border: 1px solid #ccc; border-radius: 4px;"></div>
    </div>
    
    <script>
        const form = document.getElementById('generator-form');
        const result = document.getElementById('result');
        const svgOutput = document.getElementById('svg-output');
        const svgCode = document.getElementById('svg-code');
        const downloadBtn = document.getElementById('download');
        const loader = document.getElementById('loader');
        const chatResult = document.getElementById('chat-result');
        const chatResponse = document.getElementById('chat-response');
        
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const prompt = document.getElementById('prompt').value;
            
            // Показываем индикатор загрузки
            loader.style.display = 'block';
            result.style.display = 'none';
            
            try {
                // Запрос на генерацию
                const response = await fetch('/svg-generator/generate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });
                
                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Отображаем результат
                svgOutput.innerHTML = data.svg;
                svgCode.value = data.svg;
                
                // Настраиваем кнопку загрузки
                const blob = new Blob([data.svg], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                downloadBtn.href = url;
                
                // Показываем результат
                result.style.display = 'block';
                
                // Запрашиваем описание от Qwen
                getDescription(prompt);
                
            } catch (error) {
                alert('Ошибка: ' + error.message);
                console.error('Ошибка:', error);
            } finally {
                loader.style.display = 'none';
            }
        });
        
        async function getDescription(prompt) {
            try {
                const response = await fetch('/api/python/g4f/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        message: `Опиши подробно, как может выглядеть изображение по запросу: "${prompt}". Опиши визуальные элементы, стиль, цвета и детали.`,
                        provider: 'Qwen_Qwen_2_5',
                        max_retries: 2
                    })
                });
                
                const data = await response.json();
                
                if (data.response) {
                    chatResponse.textContent = data.response;
                    chatResult.style.display = 'block';
                }
            } catch (error) {
                console.error('Ошибка получения описания:', error);
                chatResponse.textContent = 'Не удалось получить описание от ИИ.';
                chatResult.style.display = 'block';
            }
        }
    </script>
</body>
</html>