<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BOOOMERANGS: AI –ß–∞—Ç –∏ –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #111;
      color: white;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 1rem 2rem;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .logo {
      font-size: 1.5rem;
      background: linear-gradient(45deg, #ff4b2b, #ff416c);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      font-weight: bold;
    }
    
    nav {
      display: flex;
      gap: 1rem;
    }
    
    .nav-button {
      padding: 0.5rem 1rem;
      background: none;
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      border-radius: 5px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .nav-button:hover,
    .nav-button.active {
      background: rgba(255, 255, 255, 0.1);
    }
    
    main {
      flex: 1;
      padding: 2rem;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
    }
    
    .tab {
      display: none;
    }
    
    .tab.active {
      display: block;
      animation: fadeIn 0.3s ease-in-out;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    /* –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
    .image-generator {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1.5rem;
    }
    
    .prompt-container {
      width: 100%;
      max-width: 800px;
    }
    
    .prompt-input {
      width: 100%;
      padding: 1rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: white;
      font-size: 1rem;
    }
    
    .prompt-input:focus {
      outline: none;
      border-color: #ff416c;
    }
    
    .button {
      padding: 0.75rem 1.5rem;
      border: none;
      background: linear-gradient(45deg, #ff4b2b, #ff416c);
      color: white;
      font-size: 1rem;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(255, 75, 43, 0.3);
    }
    
    .loading {
      display: none;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    
    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top-color: #ff416c;
      animation: spin 1s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .image-preview {
      max-width: 800px;
      width: 100%;
      border-radius: 12px;
      overflow: hidden;
      display: none;
    }
    
    .image-preview img {
      width: 100%;
      display: block;
    }
    
    .image-actions {
      display: none;
      gap: 1rem;
      margin-top: 1rem;
    }
    
    .svg-container {
      max-width: 800px;
      width: 100%;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 12px;
      padding: 1rem;
      margin-top: 1.5rem;
      display: none;
    }
    
    .svg-container svg {
      width: 100%;
      height: auto;
      max-height: 600px;
    }
    
    /* –ß–∞—Ç */
    .chat {
      display: flex;
      flex-direction: column;
      height: 70px !important;
      max-height: 70px !important;
      min-height: 70px !important;
      border-radius: 12px;
      overflow: hidden;
      background: #1a1a2e;
      border: 1px solid #40405c;
    }
    
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 4px;
      display: flex;
      flex-direction: column;
      gap: 4px;
      background-color: #252538;
    }
    
    /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π */
    @media (min-width: 640px) {
      .chat-messages {
        padding: 6px;
        gap: 6px;
      }
    }
    
    @media (min-width: 768px) {
      .chat-messages {
        padding: 8px;
        gap: 8px;
      }
    }
    
    @media (min-width: 1024px) {
      .chat-messages {
        padding: 10px;
        gap: 10px;
      }
    }
    
    .message {
      max-width: 80%;
      padding: 1rem;
      border-radius: 12px;
      line-height: 1.5;
    }
    
    .message-user {
      align-self: flex-end;
      background: linear-gradient(45deg, #ff4b2b, #ff416c);
      border-bottom-right-radius: 0;
    }
    
    .message-ai {
      align-self: flex-start;
      background: rgba(255, 255, 255, 0.1);
      border-bottom-left-radius: 0;
    }
    
    .message p {
      margin-bottom: 0.5rem;
    }
    
    .message p:last-child {
      margin-bottom: 0;
    }
    
    .message a {
      color: #00e676;
      text-decoration: none;
    }
    
    .message a:hover {
      text-decoration: underline;
    }
    
    .message code {
      font-family: monospace;
      background: rgba(0, 0, 0, 0.3);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
    }
    
    .message pre {
      background: rgba(0, 0, 0, 0.3);
      padding: 1rem;
      border-radius: 8px;
      overflow-x: auto;
      margin: 1rem 0;
    }
    
    .message pre code {
      background: none;
      padding: 0;
    }
    
    .chat-input-container {
      padding: 1rem;
      background: rgba(0, 0, 0, 0.3);
      display: flex;
      gap: 1rem;
    }
    
    .chat-input {
      flex: 1;
      padding: 0.75rem 1rem;
      border-radius: 8px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
      color: white;
      font-size: 1rem;
      resize: none;
      min-height: 60px;
    }
    
    .chat-input:focus {
      outline: none;
      border-color: #ff416c;
    }
    
    footer {
      padding: 1rem 2rem;
      text-align: center;
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.5);
      border-top: 1px solid rgba(255, 255, 255, 0.05);
    }
    
    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 768px) {
      header {
        padding: 1rem;
      }
      
      main {
        padding: 1rem;
      }
      
      .message {
        max-width: 90%;
      }
      
      .chat-input-container {
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .nav-button {
        padding: 0.5rem;
        font-size: 0.875rem;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="logo">üöÄ BOOOMERANGS</div>
    <nav>
      <button class="nav-button active" data-tab="chat-tab">AI –ß–∞—Ç</button>
      <button class="nav-button" data-tab="image-generator-tab">–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π</button>
    </nav>
  </header>
  
  <main>
    <!-- –í–∫–ª–∞–¥–∫–∞ —á–∞—Ç–∞ -->
    <div class="tab active" id="chat-tab">
      <div class="chat">
        <div class="chat-messages" id="chat-messages">
          <div class="message message-ai">
            <p>–ü—Ä–∏–≤–µ—Ç! –Ø BOOOMERANGS AI –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç. –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å–µ–≥–æ–¥–Ω—è?</p>
          </div>
        </div>
        <div class="chat-input-container">
          <input type="file" id="image-input" accept="image/*" style="display: none;">
          <button class="button" id="attach-image" onclick="document.getElementById('image-input').click()">üìé –§–æ—Ç–æ</button>
          <textarea class="chat-input" id="chat-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..." rows="2"></textarea>
          <button class="button" id="send-message">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
        </div>
      </div>
    </div>
    
    <!-- –í–∫–ª–∞–¥–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π -->
    <div class="tab" id="image-generator-tab">
      <div class="image-generator">
        <div class="prompt-container">
          <input type="text" class="prompt-input" id="prompt-input" placeholder="–û–ø–∏—à–∏—Ç–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å...">
        </div>
        
        <button class="button" id="generate-image">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
        
        <div class="loading" id="loading">
          <div class="spinner"></div>
          <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è...</p>
        </div>
        
        <div class="image-preview" id="image-preview">
          <img id="preview-img" src="" alt="–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ">
        </div>
        
        <div class="image-actions" id="image-actions">
          <button class="button" id="convert-svg">–ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ SVG</button>
          <button class="button" id="download-image">–°–∫–∞—á–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ</button>
        </div>
        
        <div class="svg-container" id="svg-container"></div>
      </div>
    </div>
  </main>
  
  <footer>
    <p>¬© 2025 BOOOMERANGS. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.</p>
  </footer>
  
  <script>
    // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤–∫–ª–∞–¥–æ–∫
    const tabButtons = document.querySelectorAll('.nav-button');
    const tabs = document.querySelectorAll('.tab');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        const tabId = button.getAttribute('data-tab');
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–Ω–æ–ø–∫–∏
        tabButtons.forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        
        // –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∫–ª–∞–¥–∫–∏
        tabs.forEach(tab => tab.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
      });
    });
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
    const promptInput = document.getElementById('prompt-input');
    const generateButton = document.getElementById('generate-image');
    const loadingElement = document.getElementById('loading');
    const imagePreview = document.getElementById('image-preview');
    const previewImg = document.getElementById('preview-img');
    const imageActions = document.getElementById('image-actions');
    const svgContainer = document.getElementById('svg-container');
    const convertSvgButton = document.getElementById('convert-svg');
    const downloadImageButton = document.getElementById('download-image');
    
    let currentImageUrl = '';
    
    generateButton.addEventListener('click', () => {
      const prompt = promptInput.value.trim() || 'beautiful landscape';
      
      // –°–∫—Ä—ã–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
      imagePreview.style.display = 'none';
      imageActions.style.display = 'none';
      svgContainer.style.display = 'none';
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
      loadingElement.style.display = 'flex';
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º URL –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å Unsplash
      const randomSeed = Math.floor(Math.random() * 10000);
      currentImageUrl = `https://source.unsplash.com/random/800x600/?${encodeURIComponent(prompt)}&sig=${randomSeed}`;
      
      previewImg.onload = function() {
        // –°–∫—Ä—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑–∫—É –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –∫–Ω–æ–ø–∫–∏
        loadingElement.style.display = 'none';
        imagePreview.style.display = 'block';
        imageActions.style.display = 'flex';
      };
      
      previewImg.onerror = function() {
        loadingElement.style.display = 'none';
        alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π –∑–∞–ø—Ä–æ—Å.');
      };
      
      previewImg.src = currentImageUrl;
    });
    
    convertSvgButton.addEventListener('click', () => {
      if (!currentImageUrl) return;
      
      // –°–æ–∑–¥–∞–µ–º SVG –∫–æ–¥
      const svgCode = `
        <svg xmlns="http://www.w3.org/2000/svg" width="800" height="600" viewBox="0 0 800 600">
          <defs>
            <linearGradient id="grad" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" style="stop-color:#ff4b2b;stop-opacity:0.2" />
              <stop offset="100%" style="stop-color:#ff416c;stop-opacity:0.2" />
            </linearGradient>
            <filter id="posterize">
              <feComponentTransfer>
                <feFuncR type="discrete" tableValues="0 0.25 0.5 0.75 1" />
                <feFuncG type="discrete" tableValues="0 0.25 0.5 0.75 1" />
                <feFuncB type="discrete" tableValues="0 0.25 0.5 0.75 1" />
              </feComponentTransfer>
            </filter>
          </defs>
          <rect width="800" height="600" fill="url(#grad)" />
          <image href="${currentImageUrl}" width="800" height="600" filter="url(#posterize)" />
          <rect x="0" y="550" width="800" height="50" fill="rgba(0,0,0,0.8)" />
          <text x="400" y="585" font-family="Arial" font-size="24" text-anchor="middle" fill="#00e676" font-weight="bold">
            BOOOMERANGS
          </text>
        </svg>
      `;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º SVG
      svgContainer.innerHTML = svgCode;
      svgContainer.style.display = 'block';
      
      // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è SVG
      const downloadSvgButton = document.createElement('button');
      downloadSvgButton.textContent = '–°–∫–∞—á–∞—Ç—å SVG';
      downloadSvgButton.className = 'button';
      downloadSvgButton.style.marginTop = '1rem';
      downloadSvgButton.onclick = downloadSVG;
      svgContainer.appendChild(downloadSvgButton);
    });
    
    downloadImageButton.addEventListener('click', () => {
      if (!currentImageUrl) return;
      
      const link = document.createElement('a');
      link.href = currentImageUrl;
      link.download = 'booomerangs-image.jpg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    });
    
    function downloadSVG() {
      const svgCode = svgContainer.querySelector('svg').outerHTML;
      
      const blob = new Blob([svgCode], { type: 'image/svg+xml' });
      const url = URL.createObjectURL(blob);
      
      const link = document.createElement('a');
      link.href = url;
      link.download = 'booomerangs-image.svg';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }
    
    // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —á–∞—Ç–∞
    const chatMessages = document.getElementById('chat-messages');
    const chatInput = document.getElementById('chat-input');
    const sendMessageButton = document.getElementById('send-message');
    const imageInput = document.getElementById('image-input');
    let selectedImage = null;
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç
    function addMessage(text, isUser) {
      const messageDiv = document.createElement('div');
      messageDiv.className = `message ${isUser ? 'message-user' : 'message-ai'}`;
      
      // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –∞–±–∑–∞—Ü—ã
      const paragraphs = text.split('\n').filter(p => p.trim() !== '');
      paragraphs.forEach(paragraph => {
        const p = document.createElement('p');
        p.textContent = paragraph;
        messageDiv.appendChild(p);
      });
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ü–∏—Ç–∞—Ç–∞–º–∏ –≤ —á–∞—Ç
    function addMessageWithCitations(text, citations) {
      const messageDiv = document.createElement('div');
      messageDiv.className = 'message message-ai';
      
      const p = document.createElement('p');
      p.textContent = text;
      messageDiv.appendChild(p);
      
      if (citations && citations.length > 0) {
        const sourcesList = document.createElement('p');
        sourcesList.innerHTML = '<strong>–ò—Å—Ç–æ—á–Ω–∏–∫–∏:</strong>';
        messageDiv.appendChild(sourcesList);
        
        const ul = document.createElement('ul');
        ul.style.marginLeft = '20px';
        ul.style.marginTop = '8px';
        
        citations.forEach(url => {
          const li = document.createElement('li');
          const a = document.createElement('a');
          a.href = url;
          a.target = '_blank';
          a.textContent = new URL(url).hostname;
          li.appendChild(a);
          ul.appendChild(li);
        });
        
        messageDiv.appendChild(ul);
      }
      
      chatMessages.appendChild(messageDiv);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    imageInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) {
        selectedImage = file;
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        const reader = new FileReader();
        reader.onload = function(e) {
          chatInput.placeholder = `üìé –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤—ã–±—Ä–∞–Ω–æ: ${file.name}`;
        };
        reader.readAsDataURL(file);
      }
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è
    async function sendMessage() {
      const messageText = chatInput.value.trim();
      if (!messageText && !selectedImage) return;
      
      // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
      if (messageText) {
        addMessage(messageText, true);
      }
      if (selectedImage) {
        addMessage(`üìé –û—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: ${selectedImage.name}`, true);
      }
      
      // –û—á–∏—â–∞–µ–º –ø–æ–ª–µ –≤–≤–æ–¥–∞
      chatInput.value = '';
      chatInput.placeholder = '–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...';
      
      try {
        // –°–æ–∑–¥–∞–µ–º "–¥—É–º–∞—é—â–µ–µ" —Å–æ–æ–±—â–µ–Ω–∏–µ
        const thinkingDiv = document.createElement('div');
        thinkingDiv.className = 'message message-ai';
        thinkingDiv.textContent = '–î—É–º–∞—é...';
        chatMessages.appendChild(thinkingDiv);
        chatMessages.scrollTop = chatMessages.scrollHeight;
        
        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ G4F API
        let response;
        let provider = '';
        let model = '';
        
        try {
          // –ü—Ä–æ–±—É–µ–º –ø–æ–ª—É—á–∏—Ç—å –æ—Ç–≤–µ—Ç –æ—Ç G4F API
          let result;
          
          if (selectedImage) {
            // –ï—Å–ª–∏ –µ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É–µ–º FormData
            const formData = new FormData();
            formData.append('message', messageText || '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ');
            formData.append('image', selectedImage);
            
            result = await fetch('/api/ai/chat', {
              method: 'POST',
              body: formData
            });
          } else {
            // –ï—Å–ª–∏ —Ç–æ–ª—å–∫–æ —Ç–µ–∫—Å—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º JSON
            result = await fetch('/api/ai/chat', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              },
              body: JSON.stringify({ message: messageText })
            });
          }
          
          if (!result.ok) {
            throw new Error(`–û—à–∏–±–∫–∞ API: ${result.status}`);
          }
          
          const data = await result.json();
          
          if (data.success) {
            response = data.response;
            provider = data.provider;
            model = data.model;
          } else {
            throw new Error(data.error || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞');
          }
        } catch (apiError) {
          console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞—â–µ–Ω–∏–∏ –∫ G4F API:', apiError);
          
          // –ï—Å–ª–∏ API –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–ø–∞—Å–Ω–æ–π –ª–æ–∫–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
          const lowerMessage = messageText.toLowerCase();
          
          if (lowerMessage.includes('–ø—Ä–∏–≤–µ—Ç') || lowerMessage.includes('–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π')) {
            response = '–ü—Ä–∏–≤–µ—Ç! –ß–µ–º —è –º–æ–≥—É –ø–æ–º–æ—á—å –≤–∞–º —Å–µ–≥–æ–¥–Ω—è?';
          } else if (lowerMessage.includes('–∫–∞–∫ –¥–µ–ª–∞') || lowerMessage.includes('–∫–∞–∫ —Ç—ã')) {
            response = '–£ –º–µ–Ω—è –≤—Å—ë –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ —á—Ç–æ —Å–ø—Ä–æ—Å–∏–ª–∏! –Ø –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å.';
          } else if (lowerMessage.includes('–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏') || lowerMessage.includes('–∫–∞—Ä—Ç–∏–Ω–∫')) {
            response = '–ï—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ —Å–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π" –≤ –≤–µ—Ä—Ö–Ω–µ–π —á–∞—Å—Ç–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã. –¢–∞–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –æ–ø–∏—Å–∞—Ç—å –∂–µ–ª–∞–µ–º–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–æ–∑–¥–∞—Ç—å –µ–≥–æ.';
          } else if (lowerMessage.includes('booomerangs')) {
            response = 'BOOOMERANGS - —ç—Ç–æ –º—É–ª—å—Ç–∏–º–æ–¥–∞–ª—å–Ω—ã–π AI-—Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–µ—Å—Ç–∏ –¥–∏–∞–ª–æ–≥–∏ –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è. –ú—ã —Å—Ç—Ä–µ–º–∏–º—Å—è –æ–±–µ—Å–ø–µ—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –¥–ª—è –≤—Å–µ—Ö.';
          } else {
            response = '–ò–∑–≤–∏–Ω–∏—Ç–µ, —É –º–µ–Ω—è –≤–æ–∑–Ω–∏–∫–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞ –æ—Ç AI. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑ –∏–ª–∏ –∑–∞–¥–∞–π—Ç–µ –¥—Ä—É–≥–æ–π –≤–æ–ø—Ä–æ—Å.';
          }
          
          provider = '–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤';
        }
        
        // –£–¥–∞–ª—è–µ–º "–¥—É–º–∞—é—â–µ–µ" —Å–æ–æ–±—â–µ–Ω–∏–µ
        chatMessages.removeChild(thinkingDiv);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Ç–≤–µ—Ç
        if (provider && provider !== '–õ–æ–∫–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤') {
          const messageWithProvider = `${response}\n\n(–û—Ç–≤–µ—Ç –æ—Ç: ${provider}${model ? ` / ${model}` : ''})`;
          addMessage(messageWithProvider, false);
        } else {
          addMessage(response, false);
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', error);
        // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ
        addMessage('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –æ—Ç–≤–µ—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â–µ —Ä–∞–∑.', false);
      }
    }
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –∫–Ω–æ–ø–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏
    sendMessageButton.addEventListener('click', sendMessage);
    
    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    chatInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ñ–æ–∫—É—Å –Ω–∞ –ø–æ–ª–µ –≤–≤–æ–¥–∞
    chatInput.focus();
  </script>
</body>
</html>